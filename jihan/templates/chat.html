{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <link rel="stylesheet" href="{% static 'page.css' %}">
    <style>
        /* 비디오 배경 유지 */
        #pageBackground {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        #pageBackground video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 중앙에 챗봇 컨테이너 */
        .chat-container {
            width: 30%; /* 중앙에 위치하게 좌우 폭 설정 */
            margin: 30px auto 0; /* 위쪽에 100px 마진 추가 */
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 45px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* 챗봇 메시지 창 */
        #chat-box {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            padding: 10px;
            overflow-y: scroll;
            background-color: #f9f9f9;
            margin-bottom: 15px;
        }

        .bot-message, .user-message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
        }

        .bot-message {
            background-color: #e9ecef;
            text-align: left;
        }

        .user-message {
            background-color: #007bff;
            color: white;
            text-align: right;
        }

        /* 메뉴 버튼 스타일 */
        .menu-item {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 30px;
            cursor: pointer;
            text-align: center;
            width: 60%;
        }

        .menu-item:hover {
            background-color: #0056b3;
        }

        /* 하위 메뉴 스타일 */
        .submenu-item {
            background-color: #6c757d;
            color: white;
            padding: 8px 15px;
            margin: 10px;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            width: 70%;
        }

        .submenu-item:hover {
            background-color: #495057;
        }

        /* 챗봇 입력 영역 */
        #chat-form {
            width: 100%;
            display: flex;
        }

        #chat-form input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #chat-form button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin-left: 10px;
            border-radius: 5px;
        }

        #chat-form button:hover {
            background-color: #0056b3;
        }

        /* 새로운 채팅 버튼 */
        .new-chat-btn {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 15px;
        }

        .new-chat-btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <!-- 비디오 배경 -->
    <div id="pageBackground">
        <video autoplay muted loop>
            <source src="https://video.wixstatic.com/video/11062b_40811fcc9cac4a5bbfb0d93aaa94d70d/720p/mp4/file.mp4" type="video/mp4">
        </video>
    </div>

    <!-- 챗봇 컨테이너 -->
    <div class="chat-container">
        <h1>랜디마크 Chatbot</h1>
        
        <div id="chat-box">
            <div class="bot-message">Bot: 아래 메뉴 중 하나를 선택해주세요:</div>
            <div class="menu-item" data-menu="공공기관">1. 공공기관</div>
            <div class="menu-item" data-menu="건강/의료">2. 건강/의료</div>
        </div>

        <form id="chat-form">
            {% csrf_token %}
            <input type="text" id="user-input" placeholder="메시지를 입력하세요..." required>
            <button type="submit">전송</button>
        </form>
        
        <button class="new-chat-btn" id="new-chat">새로운 채팅하기</button>
    </div>

    <script>
        $(document).ready(function() {
            let selectedMenu = null;
            let chatHistory = [];
    
            // 메뉴 클릭 이벤트
            $(document).on('click', '.menu-item', function() {
                selectedMenu = $(this).data('menu');
                $('#chat-box').append('<div class="bot-message">Bot: ' + selectedMenu + '을 선택하셨습니다. 하위 메뉴를 선택해주세요:</div>');
                
                if (selectedMenu === '공공기관') {
                    $('#chat-box').append(`
                        <div class="submenu-item">① 입장 및 민원서비스 이용안내</div>
                        <div class="submenu-item">② 민원별 번호표 발급 및 창구번호 안내</div>
                        <div class="submenu-item">③ 준비서류 확인</div>
                        <div class="submenu-item">④ 민원신청서 작성안내</div>
                        <div class="submenu-item">⑤ 민원 신청서 용어 질문</div>
                        <div class="submenu-item">⑥ 관내 복지/지원금 정보 질문</div>
                    `);
                } else if (selectedMenu === '건강/의료') {
                    $('#chat-box').append(`
                        <div class="submenu-item">① 진료접수 안내</div>
                        <div class="submenu-item">② 증상 상담</div>
                        <div class="submenu-item">③ 대기실 및 진료실 위치안내</div>
                        <div class="submenu-item">④ 약국 위치 문의</div>
                        <div class="submenu-item">⑤ 수납 방법 안내</div>
                        <div class="submenu-item">⑥ 증빙서류 발급</div>
                        <div class="submenu-item">⑦ 다음 진료일 예약</div>
                    `);
                }
            });
    
            // 전송 버튼 클릭 시
            $('#chat-form').on('submit', function(e) {
                e.preventDefault();
                let userInput = $('#user-input').val();
                $('#user-input').val('');
    
                $('#chat-box').append('<div class="user-message">You: ' + userInput + '</div>');
    
                // AJAX를 통해 서버에 데이터를 전송
                $.ajax({
                    type: 'POST',
                    url: '/chatbot/',  // views.py의 chatbot 함수와 연결된 URL
                    data: {
                        'message': userInput,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        $('#chat-box').append('<div class="bot-message">Bot: ' + response.response + '</div>');
                    }
                });
            });
    
            // 새로운 채팅 버튼 클릭 시
            $('#new-chat').on('click', function() {
                $('#chat-box').html('<div class="bot-message">Bot: 아래 메뉴 중 하나를 선택해주세요:</div>');
                $('#chat-box').append('<div class="menu-item" data-menu="공공기관">1. 공공기관</div>');
                $('#chat-box').append('<div class="menu-item" data-menu="건강/의료">2. 건강/의료</div>');
            });
        });
    </script>

</body>
</html>
